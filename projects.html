<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projects - SynergySphere</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc3545;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .notification-item.unread {
      font-weight: bold;
      background-color: #f8f9fa;
    }
    .project-card {
      transition: transform 0.2s;
      cursor: pointer;
    }
    .project-card:hover {
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
<div class="d-flex">

  <!-- Sidebar -->
  <div class="d-flex flex-column bg-dark text-light p-3" style="width: 280px; min-height: 100vh;">
    <h5 class="fw-bold mb-4"><i class="fas fa-cube me-2"></i>SynergySphere</h5>

    <!-- Navigation -->
    <ul class="nav flex-column mb-4">
      <li class="nav-item mb-2">
        <a href="{{ url_for('dashboard') }}" class="nav-link text-light d-flex align-items-center">
          <i class="fas fa-tachometer-alt me-2"></i>Dashboard
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="{{ url_for('projects') }}" class="nav-link text-light d-flex align-items-center active">
          <i class="fas fa-folder me-2"></i>Projects
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="{{ url_for('tasks') }}" class="nav-link text-light d-flex align-items-center">
          <i class="fas fa-tasks me-2"></i>My Tasks
        </a>
      </li>
    </ul>

    <!-- User Profile -->
    <div class="mt-auto pt-3 border-top">
      <div class="d-flex align-items-center mb-2">
        <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
          <i class="fas fa-user text-white"></i>
        </div>
        <div>
          <strong>{{ current_user.first_name }} {{ current_user.last_name }}</strong><br>
          <small class="text-muted">{{ current_user.email }}</small>
        </div>
      </div>
      <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm w-100">
        <i class="fas fa-sign-out-alt me-1"></i>Logout
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-grow-1 p-4">
    <!-- Header with Search and Notifications -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2><i class="fas fa-folder me-2"></i>Projects</h2>
      <div class="d-flex gap-2 align-items-center">
        <!-- Search Bar -->
        <div class="position-relative">
          <input type="text" id="searchProjects" class="form-control" placeholder="Search projects..." style="width: 300px;">
          <i class="fas fa-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"></i>
        </div>
        
        <!-- Notifications -->
        <div class="position-relative">
          <button class="btn btn-outline-secondary" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount">3</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" style="width: 350px;">
            <li><h6 class="dropdown-header d-flex justify-content-between">
              <span>Notifications</span>
              <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">Mark all as read</button>
            </h6></li>
            <li><hr class="dropdown-divider"></li>
            <li class="notification-item unread" onclick="markAsRead(this)">
              <div class="px-3 py-2">
                <div class="d-flex justify-content-between">
                  <strong>New project assigned</strong>
                  <small class="text-muted">2m ago</small>
                </div>
                <small class="text-muted">You've been added to "Website Redesign" project</small>
              </div>
            </li>
            <li class="notification-item unread" onclick="markAsRead(this)">
              <div class="px-3 py-2">
                <div class="d-flex justify-content-between">
                  <strong>Task deadline approaching</strong>
                  <small class="text-muted">1h ago</small>
                </div>
                <small class="text-muted">"Update documentation" is due tomorrow</small>
              </div>
            </li>
            <li class="notification-item" onclick="markAsRead(this)">
              <div class="px-3 py-2">
                <div class="d-flex justify-content-between">
                  <strong>Project completed</strong>
                  <small class="text-muted">3h ago</small>
                </div>
                <small class="text-muted">"Mobile App Development" has been completed</small>
              </div>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-center" href="#">View all notifications</a></li>
          </ul>
        </div>

        <!-- Settings -->
        <div class="dropdown">
          <button class="btn btn-outline-secondary" data-bs-toggle="dropdown">
            <i class="fas fa-cog"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile Settings</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-bell me-2"></i>Notification Settings</a></li>
            <li><a class="dropdown-item" href="#"><i class="fas fa-palette me-2"></i>Theme</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
          </ul>
        </div>

        <!-- Create Project Button -->
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createProjectModal">
          <i class="fas fa-plus me-1"></i>Create Project
        </button>
      </div>
    </div>

    <!-- Projects Grid -->
    <div class="row g-4" id="projectsGrid">
      {% if projects %}
        {% for p in projects %}
          <div class="col-lg-4 col-md-6 project-card" onclick="openProject('{{ p.id }}')">
            <div class="card h-100 shadow-sm">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h5 class="card-title mb-0">{{ p.name }}</h5>
                  <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown" onclick="event.stopPropagation()">
                      <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="editProject('{{ p.id }}')"><i class="fas fa-edit me-2"></i>Edit</a></li>
                      <li><a class="dropdown-item text-danger" href="#" onclick="deleteProject('{{ p.id }}')"><i class="fas fa-trash me-2"></i>Delete</a></li>
                    </ul>
                  </div>
                </div>
                <p class="card-text text-muted">{{ p.description or 'No description available' }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge bg-{% if p.priority == 'High' %}danger{% elif p.priority == 'Medium' %}warning{% else %}success{% endif %}">
                    {{ p.priority or 'Medium' }}
                  </span>
                  <small class="text-muted">
                    {% if p.deadline %}
                      <i class="fas fa-calendar me-1"></i>{{ p.deadline }}
                    {% else %}
                      No deadline
                    {% endif %}
                  </small>
                </div>
              </div>
              <div class="card-footer bg-transparent">
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="fas fa-user me-1"></i>{{ p.manager or 'No manager' }}
                  </small>
                  <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); openProject('{{ p.id }}')">
                    <i class="fas fa-eye me-1"></i>View Details
                  </button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="text-center py-5">
            <i class="fas fa-folder-open fa-4x text-muted mb-4"></i>
            <h4 class="text-muted">No projects found</h4>
            <p class="text-muted">Create your first project to get started!</p>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createProjectModal">
              <i class="fas fa-plus me-2"></i>Create Project
            </button>
          </div>
        </div>
      {% endif %}
    </div>
  </div>

</div>

<!-- Create Project Modal -->
<div class="modal fade" id="createProjectModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form class="modal-content" method="POST" action="{{ url_for('create_project') }}">
      <div class="modal-header">
        <h5 class="modal-title">Create New Project</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Project Name *</label>
              <input type="text" name="name" class="form-control" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Priority</label>
              <select name="priority" class="form-select">
                <option value="Low">Low</option>
                <option value="Medium" selected>Medium</option>
                <option value="High">High</option>
              </select>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="3" placeholder="Describe your project..."></textarea>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Manager</label>
              <input type="text" name="manager" class="form-control" placeholder="Project manager name">
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Deadline</label>
              <input type="date" name="deadline" class="form-control">
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Tags</label>
          <input type="text" name="tags" class="form-control" placeholder="web, mobile, design (comma separated)">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Create Project</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Project Modal -->
<div class="modal fade" id="editProjectModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form class="modal-content" method="POST" action="#" id="editProjectForm">
      <div class="modal-header">
        <h5 class="modal-title">Edit Project</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Project Name *</label>
              <input type="text" name="name" class="form-control" id="editName" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Priority</label>
              <select name="priority" class="form-select" id="editPriority">
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="3" id="editDescription"></textarea>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Manager</label>
              <input type="text" name="manager" class="form-control" id="editManager">
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label">Deadline</label>
              <input type="date" name="deadline" class="form-control" id="editDeadline">
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Tags</label>
          <input type="text" name="tags" class="form-control" id="editTags">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Update Project</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Search functionality
document.getElementById('searchProjects').addEventListener('input', function(e) {
  const searchTerm = e.target.value.toLowerCase();
  const projectCards = document.querySelectorAll('.project-card');
  
  projectCards.forEach(card => {
    const title = card.querySelector('.card-title').textContent.toLowerCase();
    const description = card.querySelector('.card-text').textContent.toLowerCase();
    
    if (title.includes(searchTerm) || description.includes(searchTerm)) {
      card.style.display = 'block';
    } else {
      card.style.display = 'none';
    }
  });
});

// Notification functions
function markAsRead(element) {
  element.classList.remove('unread');
  updateNotificationCount();
}

function markAllAsRead() {
  document.querySelectorAll('.notification-item.unread').forEach(item => {
    item.classList.remove('unread');
  });
  updateNotificationCount();
}

function updateNotificationCount() {
  const unreadCount = document.querySelectorAll('.notification-item.unread').length;
  const badge = document.getElementById('notificationCount');
  badge.textContent = unreadCount;
  badge.style.display = unreadCount > 0 ? 'flex' : 'none';
}

// Project functions
function openProject(projectId) {
  window.location.href = `/project/${projectId}`;
}

function editProject(projectId) {
  // In a real app, you'd fetch project data and populate the form
  // For now, we'll just show the modal
  const editModal = new bootstrap.Modal(document.getElementById('editProjectModal'));
  document.getElementById('editProjectForm').action = `/project/${projectId}/edit`;
  editModal.show();
}

function deleteProject(projectId) {
  if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
    // In a real app, you'd make an AJAX request to delete the project
    fetch(`/project/${projectId}/delete`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      }
    })
    .then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('Failed to delete project');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Failed to delete project');
    });
  }
}

// Initialize notification count
updateNotificationCount();
</script>
</body>
</html>